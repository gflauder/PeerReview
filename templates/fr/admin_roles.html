{{ title('Administration') }}
{{ title('Rôles') }}

{% if added or deleted %}
	{% if success %}
		{{ lib.alert(success, "Changement de permission réussi.") }}
	{% else %}
		{{ lib.alert(success, "Le changement de permission a échoué (peut-être un double?)") }}
	{% endif %}
{% endif %}

<h2 class="page-header"><span class="glyphicon glyphicon-tags"></span> Rôles</h2>

{% if pass('can', 'create', 'role') %}
<p>Note: l'existence des rôles est déclarée dans votre fichier <code>config.ini</code> à la section <code>acl</code>.</p>
{% endif %}

{% if pass('can', 'edit', 'role') %}
<p>
	<form id="admin_role_acl_add" method="post" class="form-compact">
		<input type="hidden" name="f" value="add">
		<strong>Nouveau droit:</strong>
		<select data-label="Action" id="action" required>
			<option selected disabled>Action...
			<option value="*">* Toute action
			{% for action in actions %}
				<option>{{ action }}
			{% endfor %}
		</select>
		<select data-label="Object Type" id="objectType" required>
			<option selected disabled>Type...
			<option value="*">* Tout type
			{% for objectType in objectTypes %}
				<option>{{ objectType }}
			{% endfor %}
		</select>
		<input data-label="Object ID" placeholder="Object ID" id="objectId">
		<button type="submit"><span class="fg-ok"><span class="glyphicon glyphicon-plus"></span></span> Ajouter</button>
	</form>
</p>
{% endif %}

{% if pass('can', 'view', 'role') %}
	{% set canEdit = pass('can', 'edit', 'role') %}
	<ul class="nav nav-tabs">
		{% set first = true %}
		{% for roleId in roles %}
		<li{% if roleId == role %} class="active"{% endif %}>{{ lib.format_role(roleId) }}</li>
			{% set first = false %}
		{% endfor %}
	</ul>
	<div class="tab-content">
			<div class="tab-pane active in" id="{{ role }}">
				<div class="table-responsive">
					<table class="table table-hover table-condensed">
						<thead>
							<tr>
								<th>&nbsp;</th>
								<th>Action</th>
								<th>objectType</th>
								<th>objectId</th>
							</tr>
						</thead>
						<tbody>
							{% for right in rights %}
							<tr>
								<td class="fit">
									{% if not canEdit or (role == 'admin' and right.action == '*') or (role == 'member' and right.action == 'login') %}
										&nbsp;
									{% else %}
										<form id="admin_role_acl_del" class="form-toolbar" method="post">
											<input type="hidden" name="f" value="del">
											<input type="hidden" name="role" value="{{ role }}">
											<input type="hidden" name="action" value="{{ right.action }}">
											<input type="hidden" name="objectType" value="{{ right.objectType }}">
											<input type="hidden" name="objectId" value="{{ right.objectId }}">
											<button type="submit" class="btn btn-link fg-err"><span class="glyphicon glyphicon-minus"></span></button>
										</form>
									{% endif %}
								</td>
								<td class="fit">{% if right.action == '*' %}<em>toute action</em>{% else %}{{ right.action }}{% endif %}</td>
								<td class="fit">{% if right.objectType == '*' %}<em>tout type</em>{% else %}{{ right.objectType }}{% endif %}</td>
								<td>{% if right.objectId == 0 %}<em>tous</em>{% else %}{{ right.objectId }}{% endif %}</td>
							</tr>
							{% endfor %}
							{% if rights|length == 0 %}
								<tr><td colspan="4"><em>Aucune permission spéciale</em></td></tr>
							{% endif %}
						</tbody>
					</table>
				</div>
			</div>
	</div>
{% endif %}
